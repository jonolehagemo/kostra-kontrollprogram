package no.ssb.kostra.control.sosial.s11_sosialhjelp;

import no.ssb.kostra.control.Constants;
import no.ssb.kostra.control.ErrorReport;
import no.ssb.kostra.control.FieldDefinition;
import no.ssb.kostra.controlprogram.Arguments;
import org.junit.After;
import org.junit.Before;
import org.junit.Test;

import java.io.ByteArrayInputStream;
import java.io.InputStream;
import java.nio.charset.StandardCharsets;
import java.util.List;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertNotNull;

public class MainITest {
    InputStream sysInBackup;
    private Arguments args;
    private ErrorReport er;
    private String inputFileContent;
    private List<FieldDefinition> fieldDefinitions;


    @Before
    public void beforeTest() {
        //                  000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111122222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222223333333333333333333333333
        //                  000000000111111111122222222223333333333444444444455555555556666666666777777777788888888889999999999000000000011111111112222222222333333333344444444445555555555666666666677777777778888888888999999999900000000001111111111222222222233333333334444444444555555555566666666667777777777888888888899999999990000000000111111111122222
        //                  123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234
        inputFileContent = "4204200404000018621909663155600000000000013101512040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001021220000000000000000000000000000000000000000000000000000\n" +
                "4204200A04000018621909663155600000000000013101512040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001021220000000000000000000000000000000000000000000000000000\n" +
                "1099200404000018621909663155600000000000013101512040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001021220000000000000000000000000000000000000000000000000000\n" +
                "4204100404000018621909663155600000000000013101512040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001021220000000000000000000000000000000000000000000000000000\n" +
                "420420040400001862           00000000000013101512040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001021220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018623107148942900000000000013101512040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001021220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018620411164485900000000000013101512040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001021220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000093101512040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001021220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000019101512040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001021220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000013901512040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001022220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000013100512040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001022220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000013201512040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001021220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000013122512040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001024220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000013101012040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001025220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000013101112040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001023220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000013101212040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001023220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000013101412040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001023220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000013101612040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001023220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000013101812040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001021220000000000000000000000000000000000000000000000000000\n" +
                "42042004040000186219096631556000000000000132003  040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001021220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018623112612330500000000000013200307040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001022220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000013200305050102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001023220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000013101304080102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001024220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000013101311080102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001024220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000013101512  0102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001024220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000013101512040102030405060708091011990073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001025220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000013101512040102030405060708091011120000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001025220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000013101512040000000000000000091011120000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001025220000000000000000000000000000000000000000000000000000\n" +
                "420420040400001862190966315560000000000001310151204                        0009000000000000090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001025220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000013101512040102030405060708091011120000024050000000000240500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00010201220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000013101512040102030405060708091011120000044000000000000440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001022220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000013101512040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000032per00001025220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000013101512040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000013per00010201220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000013101512040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00010209220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000013101512040102030405060708091011120073964000000000039640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00010201220000000000000000000000000000000000000000000000000000\n" +
                "4204209040400001862190966315560000000000001310151204010203040506070809101112007396400056000073964000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00010201220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018620000000000000000000000013101512040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001023220000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000013101512040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001023620000000000000000000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000013101512040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001023160105173112171600000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000013101512040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001023120000003112180000000600000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000013101512040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001023120102170000000017000000000000000000000000000000000000\n" +
                "4204200404000018621909663155600000000000013101512040102030405060708091011120073964000000000739640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011per00001023110102173112180000000000000018000000000000000000000000\n";
        sysInBackup = System.in; // backup System.in to restore it later
        ByteArrayInputStream in = new ByteArrayInputStream(inputFileContent.getBytes(StandardCharsets.ISO_8859_1));
        System.setIn(in);

        fieldDefinitions = FieldDefinitions.getFieldDefinitions();

        args = new Arguments(new String[]{"-s", "11F", "-y", "2020", "-r", "420400"});
    }

    @After
    public void afterTest() {
        System.setIn(sysInBackup);
    }

    @Test
    public void testDoControl() {
        er = Main.doControls(args);

        if (Constants.DEBUG) {
            System.out.print(er.generateReport());
        }

        assertNotNull("Has content ErrorReport", er);
        assertEquals(Constants.CRITICAL_ERROR, er.getErrorType());
    }


}
